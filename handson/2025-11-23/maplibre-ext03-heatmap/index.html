<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>MapLibre ヒートマップ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" />
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <script>
        const map = new maplibregl.Map({
            container: 'map',
            style: {
                version: 8,
                sources: {
                    'gsi-pale': {
                        type: 'raster',
                        tiles: [
                            'https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png'
                        ],
                        tileSize: 256,
                        attribution: '&copy; <a href="https://maps.gsi.go.jp/development/ichiran.html">国土地理院</a>'
                    }
                },
                layers: [
                    {
                        id: 'gsi-pale-layer',
                        type: 'raster',
                        source: 'gsi-pale',
                        minzoom: 0,
                        maxzoom: 18
                    }
                ]
            },
            center: [139.7671, 35.6812],
            zoom: 11,
            pitch: 0,
            bearing: 0
        });
        
        map.addControl(new maplibregl.NavigationControl());
        
        map.on('load', function() {
            // ヒートマップ用データソース
            map.addSource('stations-heat', {
                type: 'geojson',
                data: {
                    type: 'FeatureCollection',
                    features: [
                        { type: 'Feature', geometry: { type: 'Point', coordinates: [139.7671, 35.6812] }, properties: { weight: 462 } },
                        { type: 'Feature', geometry: { type: 'Point', coordinates: [139.7006, 35.6896] }, properties: { weight: 775 } },
                        { type: 'Feature', geometry: { type: 'Point', coordinates: [139.7016, 35.6580] }, properties: { weight: 379 } },
                        { type: 'Feature', geometry: { type: 'Point', coordinates: [139.7387, 35.6284] }, properties: { weight: 379 } },
                        { type: 'Feature', geometry: { type: 'Point', coordinates: [139.7109, 35.7295] }, properties: { weight: 558 } },
                        { type: 'Feature', geometry: { type: 'Point', coordinates: [139.7638, 35.6938] }, properties: { weight: 250 } },
                        { type: 'Feature', geometry: { type: 'Point', coordinates: [139.7452, 35.6939] }, properties: { weight: 180 } },
                        { type: 'Feature', geometry: { type: 'Point', coordinates: [139.6760, 35.6989] }, properties: { weight: 150 } }
                    ]
                }
            });
            
            // ヒートマップレイヤー
            map.addLayer({
                id: 'stations-heatmap',
                type: 'heatmap',
                source: 'stations-heat',
                paint: {
                    // ヒートマップの重み（乗降客数を使用）
                    'heatmap-weight': [
                        'interpolate',
                        ['linear'],
                        ['get', 'weight'],
                        0, 0,
                        1000, 1
                    ],
                    // ヒートマップの強度（ズームレベルに応じて変化）
                    'heatmap-intensity': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        0, 1,
                        15, 3
                    ],
                    // ヒートマップの色
                    'heatmap-color': [
                        'interpolate',
                        ['linear'],
                        ['heatmap-density'],
                        0, 'rgba(33,102,172,0)',
                        0.2, 'rgb(103,169,207)',
                        0.4, 'rgb(209,229,240)',
                        0.6, 'rgb(253,219,199)',
                        0.8, 'rgb(239,138,98)',
                        1, 'rgb(178,24,43)'
                    ],
                    // ヒートマップの半径
                    'heatmap-radius': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        0, 2,
                        15, 50
                    ],
                    // ヒートマップの透明度（ズームで消える）
                    'heatmap-opacity': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        7, 1,
                        15, 0
                    ]
                }
            });
            
            // ズームインすると個別ポイントが表示される
            map.addLayer({
                id: 'stations-point',
                type: 'circle',
                source: 'stations-heat',
                minzoom: 13,
                paint: {
                    'circle-radius': [
                        'interpolate',
                        ['linear'],
                        ['get', 'weight'],
                        0, 5,
                        1000, 20
                    ],
                    'circle-color': '#ff6347',
                    'circle-stroke-color': 'white',
                    'circle-stroke-width': 2,
                    'circle-opacity': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        13, 0,
                        15, 1
                    ]
                }
            });
        });
    </script>
</body>
</html>