<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Deck.gl ヒートマップ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; position: relative; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/deck.gl@9.0.0/dist.min.js"></script>
    <script>
        // ランダムなポイントデータを生成（駅周辺に集中）
        const heatmapData = [];
        const stations = [
            [139.7671, 35.6812], // 東京駅
            [139.7006, 35.6896], // 新宿駅
            [139.7016, 35.6580], // 渋谷駅
            [139.7387, 35.6284], // 品川駅
            [139.7109, 35.7295]  // 池袋駅
        ];
        
        stations.forEach(station => {
            for (let i = 0; i < 100; i++) {
                heatmapData.push({
                    coordinates: [
                        station[0] + (Math.random() - 0.5) * 0.02,
                        station[1] + (Math.random() - 0.5) * 0.02
                    ],
                    weight: Math.random()
                });
            }
        });
        
        const deckgl = new deck.DeckGL({
            container: 'map',
            initialViewState: {
                longitude: 139.7671,
                latitude: 35.6812,
                zoom: 11,
                pitch: 0,
                bearing: 0
            },
            controller: true,
            layers: [
                new deck.TileLayer({
                    id: 'base-map',
                    data: 'https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png',
                    minZoom: 0,
                    maxZoom: 19,
                    tileSize: 256,
                    renderSubLayers: props => {
                        const {bbox: {west, south, east, north}} = props.tile;
                        return new deck.BitmapLayer(props, {
                            data: null,
                            image: props.data,
                            bounds: [west, south, east, north]
                        });
                    }
                }),
                new deck.HeatmapLayer({
                    id: 'heatmap',
                    data: heatmapData,
                    getPosition: d => d.coordinates,
                    getWeight: d => d.weight,
                    radiusPixels: 60,
                    intensity: 1,
                    threshold: 0.05,
                    colorRange: [
                        [255, 255, 204],
                        [199, 233, 180],
                        [127, 205, 187],
                        [65, 182, 196],
                        [44, 127, 184],
                        [37, 52, 148]
                    ]
                })
            ]
        });
    </script>
</body>
</html>