<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Deck.gl ヘキサゴン</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; position: relative; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/deck.gl@9.0.0/dist.min.js"></script>
    <script>
        // ランダムなポイントデータを生成
        const pointData = [];
        for (let i = 0; i < 500; i++) {
            pointData.push({
                coordinates: [
                    139.7671 + (Math.random() - 0.5) * 0.1,
                    35.6812 + (Math.random() - 0.5) * 0.1
                ],
                value: Math.random() * 1000
            });
        }
        
        const deckgl = new deck.DeckGL({
            container: 'map',
            initialViewState: {
                longitude: 139.7671,
                latitude: 35.6812,
                zoom: 12,
                pitch: 45,
                bearing: 0
            },
            controller: true,
            layers: [
                new deck.TileLayer({
                    id: 'base-map',
                    data: 'https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png',
                    minZoom: 0,
                    maxZoom: 19,
                    tileSize: 256,
                    renderSubLayers: props => {
                        const {bbox: {west, south, east, north}} = props.tile;
                        return new deck.BitmapLayer(props, {
                            data: null,
                            image: props.data,
                            bounds: [west, south, east, north]
                        });
                    }
                }),
                new deck.HexagonLayer({
                    id: 'hexagon-layer',
                    data: pointData,
                    getPosition: d => d.coordinates,
                    getElevationWeight: d => d.value,
                    elevationScale: 10,
                    radius: 300,
                    coverage: 0.8,
                    extruded: true,
                    pickable: true,
                    elevationRange: [0, 300],
                    colorRange: [
                        [255, 255, 204],
                        [199, 233, 180],
                        [127, 205, 187],
                        [65, 182, 196],
                        [44, 127, 184],
                        [37, 52, 148]
                    ]
                })
            ]
        });
    </script>
</body>
</html>